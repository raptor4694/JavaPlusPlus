package com.test;

from java++ import trailing_other_comma; // the only feature not enabled by default

public class Test {
	public static void main(String[] args) {
		println "Hello, world!";
	}
}

class Program implements Runnable {
	final Scanner keys = new Scanner(System.in);
	
	static enum NumberType {
		INTEGER,
		DECIMAL;
		
		public String toString() {
			return name().toLowerCase();
		}
	}
	
	NumberType numType = NumberType.INTEGER;
	
	public void run() {
		for(;;) {
			switch(menu("What do you want to do?",
					"sum a series of numbers",
					"multiply a series of numbers",
					"subtract a series of numbers from an initial number",
					"divide a series of numbers from an initial number",
					"change the numeric type (currently " + numType + ")",
					"exit the program")) {
				case 1 -> sum();
				case 2 -> multiply();
				case 3 -> subtract();
				case 4 -> divide();
				case 5 -> changeNumType();
				case 6 -> { return; }
			}
		}
	}
	
	void sum() {
		switch(numType) {
			case INTEGER -> {
				int[] numbers = inputIntList("Enter the list of numbers you wish to add: ");
				println "The sum of your numbers is:", IntStream.of(numbers).sum();
			}
			case DECIMAL -> {
				double[] numbers = inputDecimalList("Enter the list of numbers you wish to add: ");
				println "The sum of your numbers is:", DoubleStream.of(numbers).sum();
			}
		}
	}
	
	void subtract() {
		switch(numType) {
			case INTEGER -> {
				int first = inputInt("Enter the first number: ");
				int[] numbers = inputIntList("Enter the list of numbers you wish to subtract from " + first + ": ");
				println "The sum of your numbers is:", IntStream.concat(IntStream.of(first), IntStream.of(numbers)).reduce((x,y) -> x - y).get();
			}
			case DECIMAL -> {
				double first = inputDecimal("Enter the first number: ");
				double[] numbers = inputDecimalList("Enter the list of numbers you wish to subtract from " + first + ": ");
				println "The sum of your numbers is:", DoubleStream.concat(DoubleStream.of(first), DoubleStream.of(numbers)).reduce((x,y) -> x - y).get();
			}
		}
	}
	
	void multiply() {
		switch(numType) {
			case INTEGER -> {
				int[] numbers = inputIntList("Enter the list of numbers you wish to multiply: ");
				println "The sum of your numbers is:", IntStream.of(numbers).reduce((x,y) -> x * y).get();
			}
			case DECIMAL -> {
				double[] numbers = inputDecimalList("Enter the list of numbers you wish to multiply: ");
				println "The sum of your numbers is:", DoubleStream.of(numbers).reduce((x,y) -> x * y).get();
			}
		}
	}
	
	void divide() {
		switch(numType) {
			case INTEGER -> {
				int first = inputInt("Enter the first number: ");
				int[] numbers = inputIntList("Enter the list of numbers you wish to subtract from " + first + ": ");
				println "The sum of your numbers is:", IntStream.concat(IntStream.of(first), IntStream.of(numbers)).reduce((x,y) -> x / y).get();
			}
			case DECIMAL -> {
				double first = inputDecimal("Enter the first number: ");
				double[] numbers = inputDecimalList("Enter the list of numbers you wish to subtract from " + first + ": ");
				println "The sum of your numbers is:", DoubleStream.concat(DoubleStream.of(first), DoubleStream.of(numbers)).reduce((x,y) -> x / y).get();
			}
		}
	}
	
	void changeNumType() {
		numType = switch(menu("What number type do you want to use?",
				"integer",
				"decimal")) {
			case 1 -> NumberType.INTEGER;
			case 2 -> NumberType.DECIMAL;
			default -> throw new AssertionError();
		};
		printfln "The number type was changed to %s.", numType;
	}
	
	//#region parse methods
	static int parseInt(String str) {
		boolean negative = str.startsWith("-");
		if(negative || str.startsWith("+"))
			str = str.substring(1);
			
		int result;
		if(str.startsWith("0x") || str.startsWith("0X"))
			result = Integer.parseUnsignedInt(removeUnderscores(str.substring(2)), 16);
		else if(str.startsWith("0b") || str.startsWith("0B"))
			result = Integer.parseUnsignedInt(removeUnderscores(str.substring(2)), 2);
		else if(str.startsWith("0o") || str.startsWith("0O"))
			result = Integer.parseUnsignedInt(removeUnderscores(str.substring(2)), 8);
		else result = Integer.parseUnsignedInt(removeUnderscores(str));
		
		return negative? -result : result;
	}
	
	static int parseUnsignedInt(String str) {
		if(str.startsWith("0x") || str.startsWith("0X"))
			return Integer.parseUnsignedInt(removeUnderscores(str.substring(2)), 16);
		else if(str.startsWith("0b") || str.startsWith("0B"))
			return Integer.parseUnsignedInt(removeUnderscores(str.substring(2)), 2);
		else if(str.startsWith("0o") || str.startsWith("0O"))
			return Integer.parseUnsignedInt(removeUnderscores(str.substring(2)), 8);
		else return Integer.parseUnsignedInt(removeUnderscores(str));
	}
	
	static double parseDouble(String str) {
		if((str.startsWith("0x") || str.startsWith("0X") 
				|| str.startsWith("-0x") || str.startsWith("-0X")
				|| str.startsWith("+0x") || str.startsWith("+0X")
				) && !str.contains("p") && !str.contains("P"))
			str += "p0";
		return Double.parseDouble(removeUnderscores(str));
	}
	
	static String removeUnderscores(String str) {
		return str.replaceAll(r"(?<=\d)_+(?=\d)", "");
	}
	//#endregion parse methods
	
	//#region input methods
	String input(String prompt) {
		return input(prompt, allowEmpty: false);
	}
	
	String input(String prompt, boolean allowEmpty) {
		if(prompt != null)
			print prompt;
		int noSuchElementCount = 0;
		for(;;) {
			try {
				String input = keys.nextLine().strip();
				if(!allowEmpty && input.isEmpty())
					print "Empty input not allowed. Try again: ";
				else return input;
			} catch(NoSuchElementException e) {
				if(allowEmpty) {
					return "";
				} else if(noSuchElementCount++ > 3) {
					throw e;
				}
			}			
		}
	}
	
	int inputInt(String prompt) {
		String input = input(prompt, allowEmpty: false);
		for(;;) {
			try {
				return parseInt(input);
			} catch(NumberFormatException e) {
				input = input("Error: '" + input + "' is not a valid integer. Try again: ", allowEmpty: false);
			}
		}
	}
	
	int inputInt(String prompt, int defaultValue) {
		String input = input(prompt, allowEmpty: true);
		for(;;) {
			if(input.isEmpty())
				return defaultValue;
			try {
				return parseInt(input);
			} catch(NumberFormatException e) {
				input = input("Error: '" + input + "' is not a valid integer. Try again: ", allowEmpty: true);
			}
		}
	}
	
	int inputUnsignedInt(String prompt) {
		String input = input(prompt, allowEmpty: false);
		for(;;) {
			try {
				return parseUnsignedInt(input);
			} catch(NumberFormatException e) {
				try {
					parseInt(input);
					input = input("Error: signed numbers not allowed. Try again: ", allowEmpty: false);
				} catch(NumberFormatException e2) {
					input = input("Error: '" + input + "' is not a valid integer. Try again: ", allowEmpty: false);
				}
			}
		}
	}
	
	int inputUnsignedInt(String prompt, int defaultValue) {
		String input = input(prompt, allowEmpty: true);
		for(;;) {
			if(input.isEmpty())
				return defaultValue;
			try {
				return parseUnsignedInt(input);
			} catch(NumberFormatException e) {
				try {
					parseInt(input);
					input = input("Error: signed numbers not allowed. Try again: ", allowEmpty: true);
				} catch(NumberFormatException e2) {
					input = input("Error: '" + input + "' is not a valid integer. Try again: ", allowEmpty: true);
				}
			}
		}
	}
	
	double inputDecimal(String prompt) {
		String input = input(prompt, allowEmpty: false);
		for(;;) {
			try {
				return parseDouble(input);
			} catch(NumberFormatException e) {
				input = input("Error: '" + input + "' is not a valid number. Try again: ", allowEmpty: false);
			}
		}
	}
	
	double inputDecimal(String prompt, double defaultValue) {
		String input = input(prompt, allowEmpty: true);
		for(;;) {
			if(input.isEmpty())
				return defaultValue;
			try {
				return parseDouble(input);
			} catch(NumberFormatException e) {
				input = input("Error: '" + input + "' is not a valid number. Try again: ", allowEmpty: true);
			}
		}
	}
	
	double inputUnsignedDecimal(String prompt) {
		String input = input(prompt, allowEmpty: false);
		for(;;) {
			try {
				double result = parseDouble(input);
				if(Math.copySign(1.0, result) == -1.0)
					input = input("Error: signed numbers not allowed. Try again: ", allowEmpty: false);
				else return result;
			} catch(NumberFormatException e) {
				input = input("Error: '" + input + "' is not a valid number. Try again: ", allowEmpty: false);
			}
		}
	}
	
	double inputUnsignedDecimal(String prompt, double defaultValue) {
		String input = input(prompt, allowEmpty: true);
		for(;;) {
			if(input.isEmpty())
				return defaultValue;
			try {
				double result = parseDouble(input);
				if(Math.copySign(1.0, result) == -1.0)
					input = input("Error: signed numbers not allowed. Try again: ", allowEmpty: true);
				else return result;
			} catch(NumberFormatException e) {
				input = input("Error: '" + input + "' is not a valid number. Try again: ", allowEmpty: true);
			}
		}
	}
	
	int[] inputIntList(String prompt) {
		String input = input(prompt);
	forloop:
		for(;;) {
			String[] inputSplit = input.split(R"\s+");
			int[] numbers = new int[inputSplit.length];
			for(int i = 0; i < numbers.length; i++) {
				try {
					numbers[i] = parseInt(inputSplit[i]);
				} catch(NumberFormatException e) {
					println "Error: '" + inputSplit[i] + "' is not a valid integer.";
					input = input("Please re-enter your list of numbers after fixing it: ");
					continue forloop;
				}
			}
			return numbers;
		}
	}
	
	double[] inputDecimalList(String prompt) {
		String input = input(prompt);
	forloop:
		for(;;) {
			String[] inputSplit = input.split(R"\s+");
			double[] numbers = new double[inputSplit.length];
			for(int i = 0; i < numbers.length; i++) {
				try {
					numbers[i] = parseDouble(inputSplit[i]);
				} catch(NumberFormatException e) {
					println "Error: '" + inputSplit[i] + "' is not a valid number.";
					input = input("Please re-enter your list of numbers after fixing it: ");
					continue forloop;
				}
			}
			return numbers;
		}
	}
	
	//#endregion input methods
	
	int menu(String title, String... options) {
		if(title != null)
			println title;
		for(int index = 0; index < options.length; index++) {
			printfln "  %d. %s", index+1, options[i];
		}
		int selection = inputInt("Enter the number of your choice: ");
		while(selection <= 0 || selection > options.length) {
			selection = inputInt("That is not a valid option. Try again: ");
		}
		return selection;
	}
}